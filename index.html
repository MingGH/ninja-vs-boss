<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ninja vs Boss</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      height: 100%;
      font-family: sans-serif;
      background: #000;
      user-select: none;
      cursor: pointer;
    }
    canvas {
      display: block;
      width: 100vw;
      height: 100vh;
    }
    .score {
      position: absolute;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      color: white;
      font-size: 24px;
      z-index: 10;
      text-shadow: 1px 1px 4px black;
    }
  </style>
</head>
<body>
<div class="score" id="score">ü•∑ 0 vs üßì 0</div>
<canvas id="canvas"></canvas>

<script>
  const canvas = document.getElementById("canvas");
  const ctx = canvas.getContext("2d");
  canvas.width = innerWidth;
  canvas.height = innerHeight;

  const scoreDiv = document.getElementById("score");

  let bossScore = 0;
  let ninjaScore = 0;

  const particles = [];

  let dividerRatio = 0.5; // start at 50%
  let targetRatio = 0.5;

  // ÂàõÂª∫ Ninja SVG
  const ninjaSVG = `
    <svg xmlns="http://www.w3.org/2000/svg" width="200" height="200" viewBox="0 0 1792 1536" fill="#ffffff"><path fill="#ffffff" d="M320 512h896q96 0 142 86t40 229q-2 48-25.5 87.5t-57 61.5t-67 33.5t-61.5 11.5q-70 0-127.5-13T966 976.5T899.5 940T836 909t-68-13q-42 0-85 19.5t-78 43t-102.5 43T349 1021q-28 0-61.5-11.5T220 976t-57.5-61.5T137 827q-5-144 41-229.5T320 512zm448 1024q156 0 298-61t245-163.5t163.5-245T1535 768q0-118-33-225l205 163l85-194l-313-34q-1-2-2-5t-2-5.5t-2-4.5l302-125l-127-173l-192 263q-95-193-280-310.5T768 0Q559 0 382.5 103T103 382.5T0 768t103 385.5T382.5 1433T768 1536zM308 562l-52 142l125-3q-28 33-28 84q0 44 30.5 77.5T448 896q35 0 62.5-33t27.5-78q0-25-7-43l131 28l25-61zm920 0L849 709l25 61l131-28q-7 18-7 43q0 45 27.5 78t62.5 33q34 0 64.5-33.5T1183 785q0-51-28-84l125 3z"/></svg>
  `;

  // ÂàõÂª∫ Boss SVG
  const bossSVG = `
    <svg xmlns="http://www.w3.org/2000/svg" width="200" height="200" viewBox="0 0 1408 1472"><path fill="currentColor" d="M704 768q-5 3-55.5 25T590 821q38 57 73 98q-9 20-26 93t-36.5 168t-20.5 99q-1-3-21-8t-42.5-18.5T487 1215q-16-54-27-162t-17-192.5t-13-93.5q-7 3-31.5 16T348 806q-30 11-82 30t-82 30.5t-66.5 27.5t-59 32.5T24 960q-24 64-24 512h1408q0-112-5.5-292T1384 960q-12-17-34.5-33.5t-59-32.5t-66.5-27.5t-82-30.5t-82-30q-26-10-50.5-23T978 767q-7 9-11.5 93.5t-14 192.5t-25.5 162q-7 24-29.5 37.5T855 1271t-21 8q-62-303-89-360q35-41 73-98q-8-6-58.5-28T704 768zm0-704q140 0 235 103q27-13 61-3q13 2 29 1t30.5-2.5t28.5 14t23 50.5q4 16 6.5 29.5t1.5 25.5t-1 20t-4.5 18t-5.5 14.5t-9 14t-9.5 11.5t-11 12t-10.5 11q-5 25-21.5 44t-28.5 19q-22 111-110 184.5T704 704t-204-73.5T390 446q-12 0-28.5-19T340 383q-1-1-10.5-11t-11-12t-9.5-11.5t-9-14t-5.5-14.5t-4.5-18t-1-20t1.5-25.5T297 227q9-35 23-50.5t28.5-14T379 165t29-1q34-10 61 3Q564 64 704 64zm-47 224q6 0 10.5 4.5T672 303v27q20-2 32-2t32 2v-27q0-6 4.5-10.5T751 288h145q-19-34-17-47q1-10 3.5-14t5.5-5t10-4.5t13-9.5q-81-96-207-96t-207 96q6 6 13 9.5t10 4.5t5.5 5t3.5 14q2 13-17 47h145zm-177 41q-10 5-45 18q-3 18-3 37q0 112 80 192t192 80t192-80t80-192q0-19-3-37q-35-13-45-18v104q0 6-4.5 10.5T913 448H751q-6 0-10.5-4.5T736 433v-63q-15-3-32-3t-32 3v63q0 6-4.5 10.5T657 448H495q-6 0-10.5-4.5T480 433V329zm396-9h-88q-8 0-14 6t-6 14v56q0 8 6 14t14 6h88q8 0 14-6t6-14v-56q0-8-6-14t-14-6zm-344 0q-8 0-14 6t-6 14v56q0 8 6 14t14 6h88q8 0 14-6t6-14v-56q0-8-6-14t-14-6h-88z"/></svg>
  `;

  // Â∞Ü SVG ËΩ¨Êç¢‰∏∫ÂõæÂÉèÂØπË±°
  function svgToImage(svgString) {
    const img = new Image();
    const blob = new Blob([svgString], {type: 'image/svg+xml'});
    const url = URL.createObjectURL(blob);
    img.src = url;
    return img;
  }

  // ÂàõÂª∫ÂõæÂÉèÂØπË±°
  const ninjaImg = svgToImage(ninjaSVG);
  const bossImg = svgToImage(bossSVG);

  function spawn(x, y, emoji, direction) {
    for (let i = 0; i < 10; i++) {
      particles.push({
        x,
        y,
        vx: (Math.random() - 0.5) * 8 + direction * 4,
        vy: (Math.random() - 0.5) * 8,
        life: 100,
        emoji
      });
    }
  }

  function drawParticles() {
    for (let i = particles.length - 1; i >= 0; i--) {
      const p = particles[i];
      p.x += p.vx;
      p.y += p.vy;
      p.vy += 0.2;
      p.life--;
      ctx.font = "24px serif";
      ctx.globalAlpha = p.life / 100;
      ctx.fillText(p.emoji, p.x, p.y);
      ctx.globalAlpha = 1;

      if (p.life <= 0) {
        particles.splice(i, 1);
      }
    }
  }

  function drawBackground() {
    // smooth transition to new targetRatio
    dividerRatio += (targetRatio - dividerRatio) * 0.05;
    const divider = canvas.width * dividerRatio;

    const gradient = ctx.createLinearGradient(0, 0, canvas.width, 0);
    gradient.addColorStop(0, "#1e1f3a");       // ninja side
    gradient.addColorStop(dividerRatio - 0.01, "#1e1f3a");
    gradient.addColorStop(dividerRatio, "#333");             // soft center transition
    gradient.addColorStop(dividerRatio + 0.01, "#fceabb");
    gradient.addColorStop(1, "#ffcc33");       // boss side

    ctx.fillStyle = gradient;
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // ÁªòÂà∂ËÉåÊôØËßíËâ≤
    if (ninjaImg.complete) {
      ctx.globalAlpha = 0.2;
      ctx.drawImage(ninjaImg, canvas.width * 0.25 - 100, canvas.height / 2 - 100, 200, 200);
      ctx.globalAlpha = 1;
    }

    if (bossImg.complete) {
      ctx.globalAlpha = 0.2;
      ctx.drawImage(bossImg, canvas.width * 0.75 - 100, canvas.height / 2 - 100, 200, 200);
      ctx.globalAlpha = 1;
    }
  }

  function render() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    drawBackground();
    drawParticles();
    requestAnimationFrame(render);
  }

  render();

  // Ëé∑ÂèñÁªüËÆ°Êï∞ÊçÆ
  async function fetchStats() {
    try {
      const response = await fetch('https://api.996.ninja/ninja-boss/stats');
      const statsData = await response.json();

      // ÈáçÁΩÆËÆ°Êï∞
      bossScore = 0;
      ninjaScore = 0;

      // Ëß£ÊûêÊï∞ÊçÆ
      statsData.forEach(item => {
        if (item.data.roleType === 'ninja') {
          ninjaScore = item.data.total;
        } else if (item.data.roleType === 'boss') {
          bossScore = item.data.total;
        }
      });

      // Êõ¥Êñ∞ÊòæÁ§∫
      updateScoreDisplay();
    } catch (error) {
      console.error('Ëé∑ÂèñÁªüËÆ°Êï∞ÊçÆÂ§±Ë¥•:', error);
    }
  }

  // Êõ¥Êñ∞ÂàÜÊï∞ÊòæÁ§∫
  function updateScoreDisplay() {
    const total = bossScore + ninjaScore || 1;
    targetRatio = ninjaScore / total;
    scoreDiv.textContent = `ü•∑ ${ninjaScore} vs üßì ${bossScore}`;
  }

  // È°µÈù¢Âä†ËΩΩÂêéÂºÄÂßãËé∑ÂèñÁªüËÆ°Êï∞ÊçÆ
  window.addEventListener('load', () => {
    // Á´ãÂç≥Ëé∑Âèñ‰∏ÄÊ¨°Êï∞ÊçÆ
    fetchStats();
    // ÊØèÈöî5ÁßíËé∑Âèñ‰∏ÄÊ¨°Êï∞ÊçÆ
    setInterval(fetchStats, 5000);
  });

  // ÁÇπÂáª‰∫ã‰ª∂‰øùÊåÅÂéüÊù•ÁöÑÂäüËÉΩÔºàÂèØ‰ª•Âà†Èô§Â¶ÇÊûúÂè™ÈúÄË¶Å‰ªéÂêéÁ´ØËé∑ÂèñÊï∞ÊçÆÔºâ
  canvas.addEventListener("click", e => {
    const x = e.clientX;
    const y = e.clientY;
    const isLeft = x < canvas.width / 2;

    if (isLeft) {
      // Â¢ûÂä†ÂøçËÄÖÁ•®Êï∞
      fetch('https://api.996.ninja/ninja-boss/add/ninja', { method: 'GET' })
        .then(() => fetchStats()) // Êõ¥Êñ∞ÁªüËÆ°Êï∞ÊçÆ
        .catch(error => console.error('Â¢ûÂä†ÂøçËÄÖÁ•®Êï∞Â§±Ë¥•:', error));
      spawn(x, y, "ü•∑", 1);
    } else {
      // Â¢ûÂä†BossÁ•®Êï∞
      fetch('https://api.996.ninja/ninja-boss/add/boss', { method: 'GET' })
        .then(() => fetchStats()) // Êõ¥Êñ∞ÁªüËÆ°Êï∞ÊçÆ
        .catch(error => console.error('Â¢ûÂä†BossÁ•®Êï∞Â§±Ë¥•:', error));
      spawn(x, y, "üßì", -1);
    }
  });

  window.addEventListener("resize", () => {
    canvas.width = innerWidth;
    canvas.height = innerHeight;
  });
</script>
</body>
</html>
